<!DOCTYPE html>
<html>
<head>
    {% load static %}

    <title>Create Customer</title>
    <script src="https://unpkg.com/htmx.org@1.9.11"></script>
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            document.body.addEventListener('htmx:afterSwap', function(event) {
                const formsDiv = event.target; // the element that was swapped into

                // Only handle if we swapped into a formset's forms container
                if (!formsDiv.id || !formsDiv.id.endsWith('-forms')) return;

                const prefix = formsDiv.id.replace('-forms', '');
                const formsetDiv = formsDiv.closest('.formset');
                if (!formsetDiv) return;

                const totalFormsInput = formsetDiv.querySelector(`input[name="${prefix}-TOTAL_FORMS"]`);
                if (totalFormsInput) {
                    totalFormsInput.value = parseInt(totalFormsInput.value) + 1;
                    console.log(`Incremented TOTAL_FORMS for ${prefix} to ${totalFormsInput.value}`);
                }
            });
        });
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
      crossorigin="anonymous" referrerpolicy="no-referrer"/>
</head>

<body>
    <div class="card">
    <h1 class="card-title">Create Customer</h1>
    <p class="card-description">Enter your customer information.</p>
    <hr>
    <form method="post">
        {% csrf_token %}

        <div class="customer-form">
            <h2 class="form-label">Full Name:</h2>
            {{ form.display_name }}
            {% if "display_name" in form.errors %}
            <b class="error-message">{{ form.errors.display_name }}</b>
            {% endif %}

            <h2 class="form-label">Email Address:</h2>
            {{ form.email }}
            {% if "email" in form.errors %}
            <b class="error-message">{{ form.errors.email }}</b>
            {% endif %}

            <h2 class="form-label">Phone Number:</h2>
            {{ form.phone_number }}
            {% if "phone_number" in form.errors %}
            <b class="error-message">{{ form.errors.phone_number }}</b>
            {% endif %}

            <h2 class="form-label">Username:</h2>
            {{ form.username }}
            {% if "username" in form.errors %}
            <b class="error-message">{{ form.errors.username }}</b>
            {% endif %}

            <h2 class="form-label">Password:</h2>
            {{ form.password1 }}
            {% if "password1" in form.errors %}
            <b class="error-message">{{ form.errors.password1 }}</b>
            {% endif %}

            <h2 class="form-label">Retype Password:</h2>
            {{ form.password2 }}
            {% if "password2" in form.errors %}
            <b class="error-message">{{ form.errors.password2 }}</b>
            {% endif %}
        </div>

        <h2 class="form-label">Notification Groups</h2>
        {% include "customers/partials/nested_formset.html" with formsets=formsets %}

        <br>
        <input type="submit" value="Save Changes">
    </form>
</div>
</body>
</html>
